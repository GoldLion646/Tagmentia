const h=async(n,s=1920,i=1920,m=100)=>new Promise((d,t)=>{const g=new FileReader;g.onerror=()=>t(new Error("Failed to read file")),g.onload=F=>{var p;const o=new Image;o.onerror=()=>t(new Error("Failed to load image")),o.onload=async()=>{let{width:e,height:r}=o;if(e>s||r>i){const a=e/r;e>r?(e=s,r=e/a):(r=i,e=r*a)}const l=document.createElement("canvas");l.width=e,l.height=r;const u=l.getContext("2d");if(!u){t(new Error("Failed to get canvas context"));return}u.drawImage(o,0,0,e,r);let w=.9,c=null;const f=m*1024,y=.1;for(;w>=y;){const a=await new Promise(E=>{l.toBlob(E,"image/jpeg",w)});if(!a){t(new Error("Failed to compress image"));return}if(c=new File([a],n.name,{type:"image/jpeg",lastModified:Date.now()}),c.size<=f)break;w-=.1}if(!c){t(new Error("Failed to compress image"));return}d(c)},o.src=(p=F.target)==null?void 0:p.result},g.readAsDataURL(n)}),b=async(n,s=1920,i=1920,m=100)=>Promise.all(n.map(d=>h(d,s,i,m)));export{h as compressImage,b as compressImages};
